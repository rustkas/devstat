{
  "openapi": "3.0.3",
  "info": { "title": "DevState API", "version": "1.0.0" },
  "servers": [{ "url": "http://localhost:3180" }],
  "paths": {
    "/health": { "get": { "summary": "Health check", "responses": { "200": { "description": "OK" } } } },
    "/v1/devstate/verify": { "get": { "summary": "Verify HMAC chain", "parameters": [{ "in": "query", "name": "limit", "schema": { "type": "integer", "minimum": 0 } }], "responses": { "200": { "description": "Verify result" } } } },
    "/v1/devstate/state": {
      "get": { "summary": "Get current state", "responses": { "200": { "description": "State" } } },
      "post": { "summary": "Update state (patch)", "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object", "additionalProperties": true } } } }, "responses": { "200": { "description": "Update result" } } }
    },
    "/v1/devstate/history": {
      "post": { "summary": "Append history entry", "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object", "properties": { "actor": { "type": "string" }, "action": { "type": "string" }, "cp_from": { "type": "string", "nullable": true }, "cp_to": { "type": "string", "nullable": true }, "state_checksum": { "type": "string", "nullable": true }, "metadata": { "type": "object" } } } } } }, "responses": { "200": { "description": "Append result" } } }
    },
    "/v1/devstate/history/search": {
      "get": { "summary": "Search history (paginated)", "parameters": [
        { "in": "query", "name": "actor", "schema": { "type": "string" } },
        { "in": "query", "name": "action", "schema": { "type": "string" } },
        { "in": "query", "name": "since", "schema": { "type": "string", "format": "date-time" } },
        { "in": "query", "name": "until", "schema": { "type": "string", "format": "date-time" } },
        { "in": "query", "name": "limit", "schema": { "type": "integer", "minimum": 1, "maximum": 1000 } },
        { "in": "query", "name": "cursor", "schema": { "type": "integer" } }
      ], "responses": { "200": { "description": "Search result" } } }
    },
    "/v1/devstate/history/{id}": { "delete": { "summary": "Tombstone history entry", "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Delete result" } } } },
    "/v1/devstate/export": { "get": { "summary": "Export state and history files", "responses": { "200": { "description": "Export result" } } } },
    "/v1/devstate/import": { "post": { "summary": "Import state and history files", "responses": { "200": { "description": "Import result" } } } },
    "/v1/devstate/keys/active": { "get": { "summary": "Get active HMAC key", "responses": { "200": { "description": "Active key" } } } },
    "/v1/devstate/keys/rotate": { "post": { "summary": "Rotate HMAC key", "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object", "required": ["id", "secret"], "properties": { "id": { "type": "string" }, "secret": { "type": "string" } } } } } }, "responses": { "200": { "description": "Rotation result" } } } }
  }
}